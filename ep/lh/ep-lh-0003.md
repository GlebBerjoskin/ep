# linterhub: engine arguments

| Metadata     |                                         |
| ------------ |-----------------------------------------|
| EP           | lh-0003                                 |
| Version      | 1                                       |
| Title        | linterhub: engine arguments             |
| Authors      | xferra                                  |
| Status       | Draft                                   |

# Abstract

This document describes the structure of engine arguments used in linterhub as mentioned in [`ep-lh-0001`](#related).

# Motivation

There are a lot of engines of different types, distributed in different ways and they may require specific runtime environment and complex configuration for execution. This enchantment will unify how engine command line arguments are described.

# Proposal

## Schema

Each engine must include `args.json` file in JSON Schema format with the following properties:

| Property    | Type     | Required | Description |
| -           | :-:      | :-:      | -           |
| id          | string   | -        | Internal, case insensetive unique identifier, required only if the engine name is not unique |
| name        | string   | +        | Case sensetive official engine name, may not be unique |
| definitions | object   | +        | The complex object, which describe several sub-schemas |

This is mostly information that allows identifying engine. As for definitions property - it describes arguments itself and configuration section:

### Definitions

| Property    | Type     | Required | Description |
| -           | :-:      | :-:      | -           |
| arguments   | object   | +        | Schema of command line arguments |
| section     | object   | +        | Schema of configuration section for those arguments |

### Arguments

This is a sub-schema of the following structure:

```json
"arguments": {
    "type": "object",
    "description": "The engine command line arguments",
    "properties": {
        "--argument1": {
            "id": "--argument1",
            "type": "number",
            "description": "This is used for something",
            "default": 0
        },
        "argument2": {
            "id": "prefix:argument2",
            "type": "null",
            "description": "This is used for anything"
        }
    }
```

Each named command line argument is defined as a named property (and argument name from the original tool is used for that) and it is a JSON Schema object with the following properties:

| Property    | Type     | Required | Description |
| -           | :-:      | :-:      | -           |
| id          | string   | -        | The name of the argument from the original tool, may have prefix depending on the purpose; if not set then parent object name is used |
| type        | string   | +        | The value type of the argument |
| description | string   | +        | Help text from the original tool for that argument, two sentences maximum |
| default     | any      | -        | The default value for that argument |

A prefix in argument id is used internally to identify the argument purpose:

| Prefix      | Meaning  | 
| -           | :-:      |
| ""          | Described for historical purposes only and could not be changed in any way |
| "arg"       | Influence the analysis and user is allowed to change that |
| "linterhub" | Reserved argument which is common almost for all engines and could not be changed by user |

### Section

This is an object, which is introduced due to some limitations in JSON Schemas. It describes how engine configuration could be stored and normally only engine name should be changed for this template:

```json
"section": {
    "type": "object",
    "description": "The engine configuration section",
    "properties": {
        "name": {
            "type": "string",
            "description": "The engine name",
            "enum": [
                "engine name"
            ]
        },
        "options": {
            "type": "object",
            "description": "The engine configuration",
            "$ref": "#/definitions/options"
        }
    }
}
```

It allows to have an array of configurations for different engines and explicitly determine which engine has the corresponding schema.

# Unresolved

- the structure of section object is complicated and unclear
- the argument types are not described
- positional arguments are not described
- path argument and argument without a name are not described
- linterhub internal arguments are not defined
- configuration via files is not described

# Related

1. [ep-lh-0001](ep-lh-0001.md) - Linterhub

# References

1. Args schema https://github.com/repometric/linterhub/tree/master/schema/args.json
